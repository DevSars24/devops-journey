ğŸ¥ Kubernetes Service â€“ Demo (ClusterIP Example)
ğŸ‘‹ Introduction
Speaker: Piyush

Topic: Demo of Kubernetes Services

âœ… We already learned:

What is a Service?

Types of services: ClusterIP, NodePort, LoadBalancer.

Why & when to use them.

ğŸ” Now â†’ Weâ€™ll see how to create a Service and what happens if we donâ€™t create one.

ğŸ›  Step 1: Deployment YAML Setup
ğŸ“Œ A simple NGINX Deployment with 3 replicas.

apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80   # Exposing container on port 80
âš¡ Explanation:

containerPort: 80 â†’ Like Docker -p 80:80, publishing NGINX inside the pod.

ğŸƒ Step 2: Applying Deployment
kubectl apply -f deploy.yaml
âŒ First error: â€œresource name must not be emptyâ€ â†’ Caused by wrong indentation.

âœ… Fixed â†’ Remember the 4 top-level fields:

apiVersion, kind, metadata, spec.

Re-applied â†’ Deployment created successfully.

ğŸ” Step 3: Verify Deployment
kubectl get deploy -w
-w â†’ watch (like tail -f) â†’ updates continuously.

Pods start coming up.

kubectl get pods
Shows 3 running pods for the deployment.

âš ï¸ Step 4: Problem â€“ No Endpoint for User
Users must access this as a frontend web app.

âŒ Issue: No endpoint exposed.

Trying direct pod access:

kubectl get pods -o wide
Pods have IP addresses.

curl <pod-ip>:80
âŒ Fails â†’ Pod IPs are internal to cluster (not routable).


curl localhost:80
âŒ Still fails â†’ Port not exposed externally.

ğŸ‘‰ Conclusion: We need a Service.

ğŸ›° Step 5: Creating a ClusterIP Service
Check command help:


kubectl expose --help
Create Service:

kubectl expose deployment nginx-deployment --port=80
âœ… Output: â€œservice/nginx-deployment exposedâ€

Check services:

kubectl get svc
NAME	TYPE	CLUSTER-IP	PORT(S)	AGE
kubernetes	ClusterIP	10.96.0.1	443/TCP	â€¦
nginx-deployment	ClusterIP	10.97.124.2	80/TCP	â€¦

ğŸ”¬ Step 6: Inspect Service
kubectl describe svc nginx-deployment
Shows:

Type: ClusterIP

Port: 80 â†’ TargetPort: 80

Endpoints: Pod IPs (e.g., 10.244.1.3, 10.244.0.3, 10.244.1.2).

ğŸ“Œ Mapping:

Frontend (Service IP) â†’ Backend (Pods IPs).

Service = Stable Access Point.

ğŸš« Step 7: Access Problem with ClusterIP
curl <cluster-ip>:80
âŒ Doesnâ€™t work on local machine â†’ ClusterIP is internal only.

ğŸ›£ Step 8: Accessing Service in Minikube
Minikube doesnâ€™t expose ClusterIP directly â†’ Needs tunnel/port-forwarding.

Option 1: List services
minikube service list
Shows all services, but no external URLs (ClusterIP only).

Option 2: Access via Minikube Service
minikube service nginx-deployment --url
Output:

http://127.0.0.1:50029
ğŸ‘‰ Minikube binds service to a random high port (50029) and forwards it internally to port 80 on the pods.

Open in browser:
ğŸŒ http://127.0.0.1:50029 â†’ âœ… Welcome to nginx ğŸ‰

ğŸ“š Reference
Minikube Docs â†’ minikube service <service-name> --url

ClusterIP â†’ Internal-only (useful for backend + DB).

For external users â†’ Use NodePort or LoadBalancer.

ğŸ¯ Key Takeaways
ğŸ”‘ Concept	ğŸ’¡ Meaning
Pods IPs	Temporary, not stable for users.
Deployment	Ensures replicas are healthy.
Service	Stable endpoint + load balancer.
ClusterIP	Internal only, default type.
Minikube Service	Tunneling to access ClusterIP locally.

âœ… Without Service â†’ No stable endpoint.
âœ… With Service â†’ Pods grouped behind one stable address.

ğŸ‘‰ Next Lecture â†’ NodePort Service Demo ğŸ“¤
